<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Typing Playground</title>
  <style>
    :root{
      --sky:#A8D8F0;
      --cloud:#ffffff;
      --purple:#5b5fc7;
      --ink:#23304a;

      --panel: rgba(255,255,255,.82);
      --panelBorder: rgba(91,95,199,.18);

      --key:#f7fbff;
      --keyBorder:#c7d7ea;

      --lit1:#ffd166;
      --lit2:#ff6b6b;

      --softShadow: 0 10px 30px rgba(17,38,74,.12);
    }

    body{
      margin:0;
      font-family: "Comic Sans MS", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      background: linear-gradient(180deg, var(--sky) 0%, #c8f3ff 60%, #e7fff6 100%);
      color: var(--ink);
      text-align:center;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 14px 40px;
    }

    .title{
      margin: 10px auto 6px;
      font-size: clamp(34px, 5vw, 56px);
      letter-spacing: 1px;
      color: var(--purple);
      text-shadow: 0 2px 0 rgba(255,255,255,.7);
    }
    .subtitle{
      margin: 0 0 14px;
      font-size: clamp(14px, 2.4vw, 18px);
      color: #3f4aa8;
      font-weight: 800;
    }

    .card{
      background: var(--panel);
      border: 2px solid rgba(255,255,255,.95);
      border-radius: 18px;
      box-shadow: var(--softShadow);
      padding: 16px 16px 18px;
      backdrop-filter: blur(6px);
    }

    .topbar{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      border: 2px solid var(--panelBorder);
      color: var(--purple);
      font-weight: 900;
    }
    .stats{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:center;
    }

    button{
      font-size: 18px;
      font-weight: 900;
      padding: 10px 16px;
      border-radius: 14px;
      border: 0;
      cursor:pointer;
      background: #ffd166;
      box-shadow: 0 6px 0 rgba(0,0,0,.08);
    }
    button:hover{ filter: brightness(0.98); transform: translateY(1px); }
    button:active{ transform: translateY(2px); }

    .menuButtons{
      display:flex;
      gap: 10px;
      justify-content:center;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    /* One-line typing area */
    .lineBox{
      background: rgba(255,255,255,.96);
      border: 2px solid var(--panelBorder);
      border-radius: 16px;
      padding: 14px 14px;
      margin: 14px auto 10px;
      max-width: 980px;
    }

    .typingLine{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: clamp(22px, 3vw, 32px);
      letter-spacing: 2px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: clip;
      line-height: 1.35;
      user-select:none;
      display:flex;
      align-items: baseline;
      justify-content:center;
      gap: 0;
    }

    .done{ color: rgba(35,48,74,.25); }
    .current{
      color: var(--lit2);
      background: rgba(255,107,107,.15);
      border-radius: 10px;
      padding: 0 8px;
      margin: 0 2px;
      font-weight: 900;
    }
    .next{ color: rgba(35,48,74,.62); }

    .hint{
      margin-top: 8px;
      font-weight: 900;
      color: #3f4aa8;
    }

    .smiley{
      font-size: 72px;
      margin-top: 10px;
      min-height: 86px;
    }

    /* Keyboard */
    .keyboard{
      margin: 12px auto 0;
      max-width: 1040px;
      background: rgba(255,255,255,.72);
      border: 2px solid rgba(255,255,255,.95);
      border-radius: 18px;
      padding: 14px 12px;
    }

    .row{
      display:flex;
      justify-content:center;
      gap: 6px;
      margin: 6px 0;
      flex-wrap: nowrap;
    }

    .key{
      min-width: 44px;
      height: 46px;
      border-radius: 12px;
      background: var(--key);
      border: 2px solid var(--keyBorder);
      box-shadow: 0 4px 0 rgba(0,0,0,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      color: var(--ink);
      user-select:none;
      position:relative;
      font-size: 16px;
      padding: 0 6px;
    }

    .key.wide{ min-width: 88px; }
    .key.xwide{ min-width: 120px; }
    .key.space{ min-width: 360px; }

    .key.lit{
      background: linear-gradient(180deg, rgba(255,209,102,.95), rgba(255,107,107,.85));
      border-color: rgba(255,107,107,.7);
      color: #1b2233;
      box-shadow: 0 0 0 4px rgba(255,107,107,.18), 0 8px 0 rgba(0,0,0,.08);
      transform: translateY(-1px);
    }

    .key .sub{
      position:absolute;
      bottom: 4px;
      right: 6px;
      font-size: 10px;
      opacity:.55;
      font-weight: 800;
    }

    /* Instruction overlay */
    .overlay{
      margin: 10px auto 0;
      max-width: 960px;
      background: rgba(255,255,255,.86);
      border: 2px solid var(--panelBorder);
      border-radius: 18px;
      padding: 14px 14px;
    }
    .overlay h2{
      margin: 6px 0 8px;
      color: var(--purple);
    }
    .overlay p{
      margin: 6px 0;
      font-weight: 900;
    }
    .kbd{
      display:inline-block;
      padding: 2px 8px;
      border-radius: 10px;
      background: rgba(91,95,199,.12);
      border: 1px solid rgba(91,95,199,.25);
      font-weight: 900;
      color: var(--purple);
    }

    @media (max-width: 720px){
      .key.space{ min-width: 240px; }
      .key{ min-width: 36px; height: 42px; border-radius: 10px; }
      .key.wide{ min-width: 70px; }
      .key.xwide{ min-width: 96px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">KIDS ZONE</div>
    <div class="subtitle">Play. Practise. Power Up!<br>A fun way to build your typing power at Chongfu School.</div>

    <div class="card">
      <div class="topbar">
        <div class="pill" id="levelPill">Level: ‚Äî</div>
        <div class="stats">
          <div class="pill" id="timePill">Time: 60</div>
          <div class="pill" id="scorePill">Score: 0</div>
        </div>
      </div>

      <div id="menu">
        <div class="overlay">
          <h2>Choose a Level</h2>
          <div class="menuButtons">
            <button id="btnLetters">Level 1: Letters</button>
            <button id="btnSymbols">Level 2: Symbols</button>
          </div>
        </div>
      </div>

      <div id="instructions" style="display:none;"></div>

      <div id="game" style="display:none;">
        <div class="lineBox">
          <div class="typingLine" id="typingLine"></div>
          <div class="hint" id="hintText">Press the glowing key!</div>
        </div>

        <!-- FULL KEYBOARD -->
        <div class="keyboard">
          <!-- Numbers row -->
          <div class="row">
            <div class="key" data-key="`">`</div>
            <div class="key" data-key="1">1</div>
            <div class="key" data-key="2">2</div>
            <div class="key" data-key="3">3</div>
            <div class="key" data-key="4">4</div>
            <div class="key" data-key="5">5</div>
            <div class="key" data-key="6">6</div>
            <div class="key" data-key="7">7</div>
            <div class="key" data-key="8">8</div>
            <div class="key" data-key="9">9</div>
            <div class="key" data-key="0">0</div>
            <div class="key" data-key="-">-</div>
            <div class="key" data-key="=">=</div>
            <div class="key xwide" data-key="Backspace">Backspace</div>
          </div>

          <!-- Q row -->
          <div class="row">
            <div class="key wide" data-key="Tab">Tab</div>
            <div class="key" data-key="q">Q</div>
            <div class="key" data-key="w">W</div>
            <div class="key" data-key="e">E</div>
            <div class="key" data-key="r">R</div>
            <div class="key" data-key="t">T</div>
            <div class="key" data-key="y">Y</div>
            <div class="key" data-key="u">U</div>
            <div class="key" data-key="i">I</div>
            <div class="key" data-key="o">O</div>
            <div class="key" data-key="p">P</div>
            <div class="key" data-key="[">[</div>
            <div class="key" data-key="]">]</div>
            <div class="key" data-key="\\">\</div>
          </div>

          <!-- A row -->
          <div class="row">
            <div class="key xwide" data-key="CapsLock">Caps</div>
            <div class="key" data-key="a">A</div>
            <div class="key" data-key="s">S</div>
            <div class="key" data-key="d">D</div>
            <div class="key" data-key="f">F</div>
            <div class="key" data-key="g">G</div>
            <div class="key" data-key="h">H</div>
            <div class="key" data-key="j">J</div>
            <div class="key" data-key="k">K</div>
            <div class="key" data-key="l">L</div>
            <div class="key" data-key=";">;</div>
            <div class="key" data-key="'">'</div>
            <div class="key xwide" data-key="Enter">Enter</div>
          </div>

          <!-- Z row -->
          <div class="row">
            <div class="key xwide" data-key="ShiftLeft">Shift</div>
            <div class="key" data-key="z">Z</div>
            <div class="key" data-key="x">X</div>
            <div class="key" data-key="c">C</div>
            <div class="key" data-key="v">V</div>
            <div class="key" data-key="b">B</div>
            <div class="key" data-key="n">N</div>
            <div class="key" data-key="m">M</div>
            <div class="key" data-key=",">,</div>
            <div class="key" data-key=".">.</div>
            <div class="key" data-key="/">/</div>
            <div class="key xwide" data-key="ShiftRight">Shift</div>
          </div>

          <!-- Bottom row (we only light SPACE in this game) -->
          <div class="row">
            <div class="key wide" data-key="Control">Ctrl</div>
            <div class="key wide" data-key="Alt">Alt</div>
            <div class="key space" data-key=" "><span>SPACE</span><span class="sub">sp</span></div>
            <div class="key wide" data-key="AltGraph">Alt</div>
            <div class="key wide" data-key="ControlRight">Ctrl</div>
          </div>

          <!-- Dedicated symbol row (for your symbol level) -->
          <div class="row" style="margin-top:10px;">
            <div class="key" data-key=".">.</div>
            <div class="key" data-key=",">,</div>
            <div class="key" data-key="_">_</div>
            <div class="key" data-key="!">!</div>
            <div class="key" data-key="@">@</div>
          </div>
        </div>

        <div class="smiley" id="smiley"></div>

        <div class="menuButtons" style="margin-top:14px;">
          <button id="btnRestart">Restart</button>
          <button id="btnBack">Back to Levels</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // ===== SETTINGS =====
  const GAME_SECONDS = 60;
  const WIN_SCORE = 20;

  // IMPORTANT: We DO NOT auto-remove/skip the target if student doesn't type.
  // We only add more characters slowly to the right.
  const APPEND_EVERY_MS = 2500; // slower and calmer
  const MIN_APPEND = 1;
  const MAX_APPEND = 2;

  const LETTERS = "abcdefghijklmnopqrstuvwxyz";
  const SYMBOLS = ".,_!@";

  const SPACE_CHANCE_LETTERS = 0.15;
  const SPACE_IN_SYMBOLS = false; // keep symbols clean

  // ===== STATE =====
  let mode = null;         // "letters" | "symbols"
  let score = 0;
  let timeLeft = GAME_SECONDS;
  let running = false;

  let stream = "";
  let idx = 0;

  let appendTimer = null;
  let secondTimer = null;

  // ===== ELEMENTS =====
  const menu = document.getElementById("menu");
  const instructions = document.getElementById("instructions");
  const game = document.getElementById("game");

  const levelPill = document.getElementById("levelPill");
  const timePill  = document.getElementById("timePill");
  const scorePill = document.getElementById("scorePill");

  const typingLine = document.getElementById("typingLine");
  const hintText = document.getElementById("hintText");
  const smiley = document.getElementById("smiley");

  const keyEls = Array.from(document.querySelectorAll(".key"));

  // buttons
  document.getElementById("btnLetters").addEventListener("click", () => showInstructionsFor("letters"));
  document.getElementById("btnSymbols").addEventListener("click", () => showInstructionsFor("symbols"));
  document.getElementById("btnRestart").addEventListener("click", restart);
  document.getElementById("btnBack").addEventListener("click", backToMenu);

  // ===== HELPERS =====
  function setPills(){
    timePill.textContent = `Time: ${timeLeft}`;
    scorePill.textContent = `Score: ${score}`;
    levelPill.textContent = mode ? `Level: ${mode === "letters" ? "Letters" : "Symbols"}` : "Level: ‚Äî";
  }

  function clearKeyLights(){
    keyEls.forEach(k => k.classList.remove("lit"));
  }

  function lightKeyFor(ch){
    clearKeyLights();

    // Special mapping for Space/Enter/Backspace etc (if ever used)
    // For our game, we light letters, symbols, and space only.
    const key = ch;

    // Find ALL matching (some keys appear twice like "." and ",")
    const matches = keyEls.filter(k => k.dataset.key === key);
    if (matches.length) matches.forEach(m => m.classList.add("lit"));
  }

  function randFrom(set){
    return set[Math.floor(Math.random() * set.length)];
  }

  function randomChar(){
    if (mode === "letters"){
      if (Math.random() < SPACE_CHANCE_LETTERS) return " ";
      return randFrom(LETTERS);
    }
    // symbols mode
    if (SPACE_IN_SYMBOLS && Math.random() < 0.1) return " ";
    return randFrom(SYMBOLS);
  }

  function appendChars(){
    if (!running) return;

    // If the student is stuck at the beginning, don't flood the line too fast.
    // This slows down further when there's a long queue.
    if ((stream.length - idx) > 40) return;

    const count = Math.floor(Math.random() * (MAX_APPEND - MIN_APPEND + 1)) + MIN_APPEND;
    for (let i=0; i<count; i++) stream += randomChar();

    // Keep line manageable (one line)
    if (stream.length > 70){
      const keepFrom = Math.max(0, idx - 10); // keep a little history
      stream = stream.slice(keepFrom);
      idx = idx - keepFrom;
      if (idx < 0) idx = 0;
    }

    renderLine();
  }

  function renderLine(){
    const done = stream.slice(0, idx);
    const current = stream[idx] ?? "";
    const next = stream.slice(idx+1);

    const show = (s) => s.replaceAll(" ", "‚ê†");
    typingLine.innerHTML =
      `<span class="done">${escapeHTML(show(done))}</span>` +
      `<span class="current">${escapeHTML(show(current || " "))}</span>` +
      `<span class="next">${escapeHTML(show(next))}</span>`;

    const target = current || " ";
    lightKeyFor(target);

    hintText.textContent = (target === " ")
      ? "Press SPACE (glowing key)!"
      : "Press the glowing key!";
  }

  function escapeHTML(str){
    return str.replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
    }[m]));
  }

  function showInstructionsFor(chosenMode){
    mode = chosenMode;
    setPills();

    menu.style.display = "none";
    game.style.display = "none";
    instructions.style.display = "block";
    smiley.textContent = "";

    if (mode === "letters"){
      instructions.innerHTML = `
        <div class="overlay">
          <h2>Level 1: Letters</h2>
          <p>Type the <span class="kbd">letters</span> in the line (1 line only).</p>
          <p>Follow the <span class="kbd">glowing key</span> on the full keyboard.</p>
          <p>You have <span class="kbd">60 seconds</span>. Score <span class="kbd">${WIN_SCORE}</span> to get a smiley üòä</p>
          <div class="menuButtons">
            <button id="startBtn">Start</button>
          </div>
        </div>
      `;
    } else {
      instructions.innerHTML = `
        <div class="overlay">
          <h2>Level 2: Symbols</h2>
          <p>Only these symbols appear:</p>
          <p><span class="kbd">.</span> <span class="kbd">,</span> <span class="kbd">_</span> <span class="kbd">!</span> <span class="kbd">@</span></p>
          <p>Follow the <span class="kbd">glowing key</span>.</p>
          <p>You have <span class="kbd">60 seconds</span>. Score <span class="kbd">${WIN_SCORE}</span> to get a smiley üòä</p>
          <div class="menuButtons">
            <button id="startBtn">Start</button>
          </div>
        </div>
      `;
    }

    document.getElementById("startBtn").addEventListener("click", startGame);
  }

  function startGame(){
    running = true;
    score = 0;
    timeLeft = GAME_SECONDS;
    stream = "";
    idx = 0;
    smiley.textContent = "";

    instructions.style.display = "none";
    game.style.display = "block";
    setPills();

    // prefill
    for (let i=0; i<26; i++) stream += randomChar();
    renderLine();

    clearInterval(appendTimer);
    appendTimer = setInterval(appendChars, APPEND_EVERY_MS);

    clearInterval(secondTimer);
    secondTimer = setInterval(() => {
      if (!running) return;
      timeLeft--;
      setPills();
      if (timeLeft <= 0) endGame();
    }, 1000);
  }

  function endGame(){
    running = false;
    clearInterval(appendTimer);
    clearInterval(secondTimer);
    clearKeyLights();

    if (score >= WIN_SCORE){
      smiley.textContent = "üòäüéâ Great Job!";
    } else {
      smiley.textContent = "‚≠ê Try Again!";
    }
  }

  function backToMenu(){
    running = false;
    clearInterval(appendTimer);
    clearInterval(secondTimer);
    clearKeyLights();

    mode = null;
    setPills();

    menu.style.display = "block";
    instructions.style.display = "none";
    game.style.display = "none";
    instructions.innerHTML = "";
    smiley.textContent = "";
  }

  function restart(){
    if (!mode) return;
    startGame();
  }

  // ===== INPUT =====
  document.addEventListener("keydown", (e) => {
    if (!running) return;

    const expected = stream[idx] ?? "";
    let pressed = e.key;

    // Normalize space
    if (pressed === "Spacebar") pressed = " ";
    if (pressed === " ") pressed = " ";

    // Letters mode: accept upper/lower
    if (mode === "letters" && pressed.length === 1){
      pressed = pressed.toLowerCase();
    }

    // Only accept correct input; if wrong, do nothing (target stays)
    if (pressed === expected){
      score++;
      idx++;
      setPills();

      // ensure there's always more ahead
      if (stream.length - idx < 12) appendChars();

      renderLine();

      if (score >= WIN_SCORE){
        smiley.textContent = "üòä";
      }
    }
  });

  // init
  setPills();
})();
</script>
</body>
</html>
